<section class="max-w-7xl mx-auto px-4 py-10">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
    
    <!-- Product Media -->
    <product-media-section [media]="product?.images" />

    <!-- Product Info -->
    <div class="flex flex-col gap-6">
      
      <!-- Breadcrumb / Category -->
      @if (product?.categories && product?.categories?.length) {
      <div class="flex items-center gap-2 text-sm text-gray-500">
        <span>Home</span>
        <span>/</span>
        <span>{{ product?.categories?.[0]?.name }}</span>
        <span>/</span>
        <span class="text-gray-900">{{ product?.name }}</span>
      </div>
      }

      <!-- Product Title -->
      <div>
        <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-3">{{ product?.name }}</h1>
        
        <!-- Rating & Reviews -->
        <div class="flex items-center gap-4 flex-wrap">
          <div class="flex items-center gap-1">
            @for (star of [1,2,3,4,5]; track star) {
              @if (star <= Math.floor(getRating())) {
                <svg class="w-5 h-5 text-yellow-400 fill-yellow-400" viewBox="0 0 24 24">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" stroke="currentColor" stroke-width="2"/>
                </svg>
              } @else {
                <svg class="w-5 h-5 text-gray-300 fill-gray-300" viewBox="0 0 24 24">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" stroke="currentColor" stroke-width="2"/>
                </svg>
              }
            }
            <span class="text-sm font-semibold text-gray-900 ml-1">{{ getRating() }}</span>
          </div>
          <span class="text-sm text-gray-500">({{ getReviewCount() }} reviews)</span>
        </div>
      </div>

      <!-- Price Section -->
      <app-price-tag 
        [price]="product?.price ?? 0" 
        [originalPrice]="getOriginalPrice()"
        size="4xl"
        [showBadge]="true">
      </app-price-tag>

      <!-- Stock Status Alert -->
      <div class="flex items-start gap-3 p-4 rounded-xl border-2"
           [class.border-green-200]="getStockStatus() === 'in-stock'"
           [class.bg-green-50]="getStockStatus() === 'in-stock'"
           [class.border-orange-200]="getStockStatus() === 'low-stock'"
           [class.bg-orange-50]="getStockStatus() === 'low-stock'"
           [class.border-red-200]="getStockStatus() === 'out-of-stock'"
           [class.bg-red-50]="getStockStatus() === 'out-of-stock'">
        <div class="flex-shrink-0 mt-0.5">
          @if (getStockStatus() === 'in-stock') {
            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          } @else if (getStockStatus() === 'low-stock') {
            <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
          } @else {
            <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          }
        </div>
        <div class="flex-1">
          @if (getStockStatus() === 'in-stock') {
            <p class="text-sm font-semibold text-green-800">In Stock</p>
            <p class="text-xs text-green-600 mt-0.5">{{ getStockQuantity() }} units available</p>
          } @else if (getStockStatus() === 'low-stock') {
            <p class="text-sm font-semibold text-orange-800">Low Stock - Order Soon!</p>
            <p class="text-xs text-orange-600 mt-0.5">Only {{ getStockQuantity() }} units left</p>
          } @else {
            <p class="text-sm font-semibold text-red-800">Out of Stock</p>
            <p class="text-xs text-red-600 mt-0.5">This item is currently unavailable</p>
          }
        </div>
      </div>

      <!-- Size Selection -->
      <div>
        <label class="text-sm font-semibold text-gray-900 mb-3 block">
          Select Size: <span class="text-indigo-600">{{ selectedSize() }}</span>
        </label>
        <div class="flex flex-wrap gap-2">
          @for (size of sizes; track size) {
            <button
              (click)="selectSize(size)"
              [class.border-indigo-600]="selectedSize() === size"
              [class.bg-indigo-50]="selectedSize() === size"
              [class.text-indigo-600]="selectedSize() === size"
              [class.border-gray-200]="selectedSize() !== size"
              [class.text-gray-700]="selectedSize() !== size"
              class="min-w-[3rem] px-4 py-2.5 border-2 rounded-xl font-semibold transition-all duration-200 hover:border-indigo-600 hover:bg-indigo-50 hover:text-indigo-600 shadow-sm hover:shadow-md">
              {{ size }}
            </button>
          }
        </div>
      </div>

      <!-- Color Selection -->
      <div>
        <label class="text-sm font-semibold text-gray-900 mb-3 block">
          Select Color: <span class="text-indigo-600">{{ selectedColor() }}</span>
        </label>
        <div class="flex flex-wrap gap-3">
          @for (color of colors; track color.name) {
            <button
              (click)="selectColor(color.name)"
              [class.ring-2]="selectedColor() === color.name"
              [class.ring-indigo-600]="selectedColor() === color.name"
              [class.ring-offset-2]="selectedColor() === color.name"
              class="group relative w-12 h-12 rounded-full border-2 border-gray-100 shadow-sm transition-all duration-200 hover:scale-110 hover:shadow-md"
              [style.backgroundColor]="color.hex"
              [title]="color.name">
              @if (selectedColor() === color.name) {
                <svg class="absolute inset-0 m-auto w-6 h-6 text-white drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                </svg>
              }
            </button>
          }
        </div>
      </div>

      <!-- Quantity Selector -->
      <div>
        <label class="text-sm font-semibold text-gray-900 mb-3 block">Quantity</label>
        <div class="flex items-center gap-4">
          <div class="flex items-center border-2 border-gray-100 rounded-xl overflow-hidden shadow-sm">
            <button
              (click)="decrementQuantity()"
              [disabled]="quantity() <= 1"
              class="px-4 py-3 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              <lucide-icon [img]="MinusIcon" class="w-4 h-4"></lucide-icon>
            </button>
            <span class="px-6 py-3 font-semibold text-gray-900 min-w-[3rem] text-center border-x-2 border-gray-100 bg-white">
              {{ quantity() }}
            </span>
            <button
              (click)="incrementQuantity()"
              [disabled]="quantity() >= getStockQuantity()"
              class="px-4 py-3 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              <lucide-icon [img]="PlusIcon" class="w-4 h-4"></lucide-icon>
            </button>
          </div>
          <span class="text-sm text-gray-500">{{ getStockQuantity() }} available</span>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-wrap gap-3 pt-4">
        <button
          (click)="addToCart()"
          [disabled]="getStockStatus() === 'out-of-stock'"
          class="flex-1 min-w-[200px] flex items-center justify-center gap-2 bg-gray-900 hover:bg-black text-white font-bold px-8 py-4 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none">
          <lucide-icon [img]="CartIcon" class="w-5 h-5"></lucide-icon>
          <span>{{ getStockStatus() === 'out-of-stock' ? 'Out of Stock' : 'Add to Cart' }}</span>
        </button>
        <button
          (click)="toggleFavorite()"
          [class.bg-indigo-50]="isFavorite()"
          [class.border-indigo-600]="isFavorite()"
          [class.text-indigo-600]="isFavorite()"
          [class.border-gray-200]="!isFavorite()"
          [class.text-gray-700]="!isFavorite()"
          class="flex items-center justify-center gap-2 border-2 hover:border-indigo-600 hover:bg-indigo-50 hover:text-indigo-600 px-6 py-4 rounded-xl transition-all duration-200 font-semibold shadow-sm hover:shadow-md">
          @if (isFavorite()) {
            <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="2"/>
            </svg>
          } @else {
            <lucide-icon [img]="HeartIcon" class="w-5 h-5"></lucide-icon>
          }
        </button>
      </div>

      <!-- Features -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 pt-6 border-t border-gray-100">
        <div class="flex items-start gap-3">
          <div class="flex-shrink-0 w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center">
            <lucide-icon [img]="TruckIcon" class="w-5 h-5 text-indigo-600"></lucide-icon>
          </div>
          <div>
            <p class="text-sm font-semibold text-gray-900">Free Delivery</p>
            <p class="text-xs text-gray-500 mt-0.5">On orders over $50</p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <div class="flex-shrink-0 w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center">
            <lucide-icon [img]="RefreshCwIcon" class="w-5 h-5 text-indigo-600"></lucide-icon>
          </div>
          <div>
            <p class="text-sm font-semibold text-gray-900">Easy Returns</p>
            <p class="text-xs text-gray-500 mt-0.5">30-day return policy</p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <div class="flex-shrink-0 w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center">
            <lucide-icon [img]="ShieldCheckIcon" class="w-5 h-5 text-indigo-600"></lucide-icon>
          </div>
          <div>
            <p class="text-sm font-semibold text-gray-900">Secure Payment</p>
            <p class="text-xs text-gray-500 mt-0.5">100% secure checkout</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabbed Content Section -->
  <div class="mt-16">
    <!-- Tab Headers -->
    <div class="border-b border-gray-100">
      <div class="flex gap-8">
        <button
          (click)="switchTab('overview')"
          [class.border-indigo-600]="activeTab() === 'overview'"
          [class.text-indigo-600]="activeTab() === 'overview'"
          [class.font-bold]="activeTab() === 'overview'"
          [class.border-transparent]="activeTab() !== 'overview'"
          [class.text-gray-500]="activeTab() !== 'overview'"
          class="pb-4 border-b-2 font-medium transition-colors hover:text-indigo-600">
          Overview
        </button>
        <button
          (click)="switchTab('specifications')"
          [class.border-indigo-600]="activeTab() === 'specifications'"
          [class.text-indigo-600]="activeTab() === 'specifications'"
           [class.font-bold]="activeTab() === 'specifications'"
          [class.border-transparent]="activeTab() !== 'specifications'"
          [class.text-gray-500]="activeTab() !== 'specifications'"
          class="pb-4 border-b-2 font-medium transition-colors hover:text-indigo-600">
          Specifications
        </button>
        <button
          (click)="switchTab('reviews')"
          [class.border-indigo-600]="activeTab() === 'reviews'"
          [class.text-indigo-600]="activeTab() === 'reviews'"
           [class.font-bold]="activeTab() === 'reviews'"
          [class.border-transparent]="activeTab() !== 'reviews'"
          [class.text-gray-500]="activeTab() !== 'reviews'"
          class="pb-4 border-b-2 font-medium transition-colors hover:text-indigo-600">
          Reviews ({{ getReviewCount() }})
        </button>
      </div>
    </div>

    <!-- Tab Content -->
    <div class="py-8">
      <!-- Overview Tab -->
      @if (activeTab() === 'overview') {
        <div class="prose max-w-none text-gray-600">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Product Description</h3>
          <p class="leading-relaxed">
            {{ product?.description || 'No description available.' }}
          </p>
        </div>
      }

      <!-- Specifications Tab -->
      @if (activeTab() === 'specifications') {
        <div>
          <h3 class="text-xl font-bold text-gray-900 mb-6">Product Specifications</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            @for (spec of specifications | keyvalue; track spec.key) {
              <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-xl border border-gray-100">
                <div class="flex-1">
                  <p class="text-sm font-semibold text-gray-500 uppercase tracking-wide">{{ spec.key }}</p>
                  <p class="text-base font-medium text-gray-900 mt-1">{{ spec.value }}</p>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Reviews Tab -->
      @if (activeTab() === 'reviews') {
        <div>
          <h3 class="text-xl font-bold text-gray-900 mb-6">Customer Reviews</h3>
          <p class="text-gray-500 italic">Reviews section coming soon...</p>
        </div>
      }
    </div>
  </div>
</section>

<!-- Add Math to component scope -->
<script>
  Math = Math;
</script>