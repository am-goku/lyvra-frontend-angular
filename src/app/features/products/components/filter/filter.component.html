<!-- MOBILE: Filter button + Search bar -->
<div class="sm:hidden flex items-center gap-3 px-4 mt-4">
  <!-- Filter Button with Badge -->
  <button
    (click)="setIsDrawerOpen()"
    class="relative bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white px-5 py-3 rounded-xl flex items-center gap-2 shadow-lg hover:shadow-xl transition-all duration-200 flex-shrink-0 font-medium">
    <lucide-icon [img]="SliderIcon" class="w-5 h-5"></lucide-icon>
    <span class="text-sm font-semibold">Filters</span>
    @if (getActiveFilterCount() > 0) {
    <span class="absolute -top-2 -right-2 bg-white text-indigo-600 text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center shadow-md">
      {{ getActiveFilterCount() }}
    </span>
    }
  </button>

  <!-- Search Bar -->
  <div class="flex-1 relative">
    <input
      type="text"
      [(ngModel)]="searchQuery"
      placeholder="Search products..."
      class="w-full pl-4 pr-10 py-3 rounded-xl placeholder:text-gray-400 border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm shadow-sm transition-all" />
    <lucide-icon
      [img]="SearchIcon"
      class="w-5 h-5 absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></lucide-icon>
  </div>
</div>

<!-- MOBILE DRAWER -->
@if (isDrawerOpen) {
<div class="fixed inset-0 z-50 sm:hidden" (click)="setIsDrawerOpen()">
  <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
  <div
    class="absolute right-0 top-0 bottom-0 w-80 max-w-[85vw] bg-white shadow-2xl transform transition-transform duration-300"
    (click)="$event.stopPropagation()">
    
    <!-- Header -->
    <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-indigo-700 text-white p-5 flex items-center justify-between shadow-lg z-10">
      <div class="flex items-center gap-3">
        <lucide-icon [img]="SliderIcon" class="w-6 h-6"></lucide-icon>
        <h3 class="text-xl font-bold">Filters</h3>
        @if (getActiveFilterCount() > 0) {
        <span class="bg-white text-indigo-600 text-xs font-bold px-2.5 py-1 rounded-full">
          {{ getActiveFilterCount() }}
        </span>
        }
      </div>
      <button
        (click)="setIsDrawerOpen()"
        class="text-white/90 hover:text-white transition-colors p-1">
        <lucide-icon [img]="XIcon" class="w-6 h-6"></lucide-icon>
      </button>
    </div>

    <!-- Filters Content -->
    <div class="overflow-y-auto h-[calc(100vh-140px)] px-5 py-6 space-y-4">
      
      <!-- Clear All Button -->
      @if (hasActiveFilters()) {
      <button
        (click)="clearAllFilters()"
        class="w-full text-indigo-600 hover:text-indigo-700 font-medium text-sm py-2 px-4 border border-indigo-200 hover:border-indigo-300 rounded-lg transition-all duration-200 hover:bg-indigo-50">
        Clear All Filters
      </button>
      }

      <!-- Category Section -->
      <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
        <button
          (click)="toggleSection('category')"
          class="w-full flex items-center justify-between p-5 group">
          <div class="flex items-center gap-2.5">
            <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Category</span>
            @if (selectedCategories().length > 0) {
            <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full">
              {{ selectedCategories().length }}
            </span>
            }
          </div>
          <lucide-icon 
            [img]="expandedSections().category ? ChevronUpIcon : ChevronDownIcon" 
            class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
          </lucide-icon>
        </button>
        @if (expandedSections().category) {
        <div class="px-5 pb-5 space-y-3 animate-slideDown">
          @for (cat of categories; track cat.id) {
          <label class="flex items-start justify-between cursor-pointer group select-none">
            <div class="flex items-center gap-3">
              <div class="relative flex items-center">
                <input 
                  type="checkbox" 
                  [checked]="selectedCategories().includes(cat.id)"
                  (change)="toggleCategory(cat.id)"
                  class="peer appearance-none w-5 h-5 border-2 border-gray-300 rounded-md checked:bg-indigo-600 checked:border-indigo-600 focus:ring-0 transition-all duration-200 cursor-pointer" />
                <lucide-icon [img]="CheckIcon" class="absolute inset-0 m-auto w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity duration-200"></lucide-icon>
              </div>
              <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors">{{ cat.name }}</span>
            </div>
            <span class="text-xs text-gray-400 bg-gray-50 px-2 py-1 rounded-full">{{ cat.count }}</span>
          </label>
          }
        </div>
        }
      </div>

      <!-- Gender Section -->
      <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
        <button
          (click)="toggleSection('gender')"
          class="w-full flex items-center justify-between p-5 group">
          <div class="flex items-center gap-2.5">
            <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Gender</span>
            @if (selectedGenders().length > 0) {
            <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full">
              {{ selectedGenders().length }}
            </span>
            }
          </div>
          <lucide-icon 
            [img]="expandedSections().gender ? ChevronUpIcon : ChevronDownIcon" 
            class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
          </lucide-icon>
        </button>
        @if (expandedSections().gender) {
        <div class="px-5 pb-5 space-y-3 animate-slideDown">
          @for (gender of genders; track gender) {
          <label class="flex items-center gap-3 cursor-pointer group select-none">
            <div class="relative flex items-center">
              <input 
                type="checkbox" 
                [checked]="selectedGenders().includes(gender)"
                (change)="toggleGender(gender)"
                class="peer appearance-none w-5 h-5 border-2 border-gray-300 rounded-md checked:bg-indigo-600 checked:border-indigo-600 focus:ring-0 transition-all duration-200 cursor-pointer" />
              <lucide-icon [img]="CheckIcon" class="absolute inset-0 m-auto w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity duration-200"></lucide-icon>
            </div>
            <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors">{{ gender }}</span>
          </label>
          }
        </div>
        }
      </div>

      <!-- Brand Section -->
      <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
        <button
          (click)="toggleSection('brand')"
          class="w-full flex items-center justify-between p-5 group">
          <div class="flex items-center gap-2.5">
            <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Brand</span>
            @if (selectedBrands().length > 0) {
            <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full">
              {{ selectedBrands().length }}
            </span>
            }
          </div>
          <lucide-icon 
            [img]="expandedSections().brand ? ChevronUpIcon : ChevronDownIcon" 
            class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
          </lucide-icon>
        </button>
        @if (expandedSections().brand) {
        <div class="px-5 pb-5 space-y-3 animate-slideDown">
          @for (brand of brands; track brand) {
          <label class="flex items-center gap-3 cursor-pointer group select-none">
            <div class="relative flex items-center">
               <input 
                type="checkbox" 
                [checked]="selectedBrands().includes(brand)"
                (change)="toggleBrand(brand)"
                class="peer appearance-none w-5 h-5 border-2 border-gray-300 rounded-md checked:bg-indigo-600 checked:border-indigo-600 focus:ring-0 transition-all duration-200 cursor-pointer" />
                 <lucide-icon [img]="CheckIcon" class="absolute inset-0 m-auto w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity duration-200"></lucide-icon>
            </div>
            <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors">{{ brand }}</span>
          </label>
          }
        </div>
        }
      </div>

      <!-- Price Range Section -->
      <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
        <button
          (click)="toggleSection('price')"
          class="w-full flex items-center justify-between p-5 group">
          <div class="flex items-center gap-2.5">
            <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Price Range</span>
            @if (minPrice() > 0 || maxPrice() < 500) {
            <span class="w-2 h-2 rounded-full bg-indigo-600"></span>
            }
          </div>
          <lucide-icon 
            [img]="expandedSections().price ? ChevronUpIcon : ChevronDownIcon" 
            class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
          </lucide-icon>
        </button>
        @if (expandedSections().price) {
        <div class="px-5 pb-5 space-y-4 animate-slideDown">
          <div class="flex items-center gap-3">
            <div class="flex-1 relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">$</span>
              <input 
                type="number" 
                [(ngModel)]="minPrice"
                min="0" 
                max="500"
                placeholder="0"
                class="w-full pl-6 pr-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm font-medium text-gray-700 transition-shadow" />
            </div>
            <span class="text-gray-300 font-medium">to</span>
            <div class="flex-1 relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">$</span>
              <input 
                type="number" 
                [(ngModel)]="maxPrice"
                min="0" 
                max="500"
                placeholder="500"
                class="w-full pl-6 pr-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm font-medium text-gray-700 transition-shadow" />
            </div>
          </div>
          <!-- Visual Range Bar (Mock) -->
          <div class="relative h-1.5 bg-gray-100 rounded-full overflow-hidden">
             <div class="absolute inset-y-0 bg-indigo-600/20 w-full"></div>
             <div class="absolute inset-y-0 left-[10%] right-[20%] bg-indigo-600 rounded-full"></div>
          </div>
        </div>
        }
      </div>

      <!-- Color Section -->
      <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
        <button
          (click)="toggleSection('color')"
          class="w-full flex items-center justify-between p-5 group">
          <div class="flex items-center gap-2.5">
            <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Color</span>
            @if (selectedColors().length > 0) {
            <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full">
              {{ selectedColors().length }}
            </span>
            }
          </div>
          <lucide-icon 
            [img]="expandedSections().color ? ChevronUpIcon : ChevronDownIcon" 
            class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
          </lucide-icon>
        </button>
        @if (expandedSections().color) {
        <div class="px-5 pb-5 animate-slideDown">
          <div class="flex flex-wrap gap-3">
            @for (color of colors; track color.id) {
            <button
              (click)="toggleColor(color.id)"
              [class.ring-2]="selectedColors().includes(color.id)"
              [class.ring-indigo-600]="selectedColors().includes(color.id)"
              [class.ring-offset-2]="selectedColors().includes(color.id)"
              class="relative w-9 h-9 rounded-full cursor-pointer transition-all duration-200 hover:scale-110 shadow-sm hover:shadow-md border border-gray-100"
              [style.backgroundColor]="color.hex"
              [title]="color.name">
              @if (selectedColors().includes(color.id)) {
              <svg class="absolute inset-0 m-auto w-4 h-4 text-white drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
              </svg>
              }
            </button>
            }
          </div>
        </div>
        }
      </div>

      <!-- Rating Section -->
      <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
        <button
          (click)="toggleSection('rating')"
          class="w-full flex items-center justify-between p-5 group">
          <div class="flex items-center gap-2.5">
            <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Rating</span>
            @if (minRating() > 0) {
            <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full">
              {{ minRating() }}+ ⭐
            </span>
            }
          </div>
          <lucide-icon 
            [img]="expandedSections().rating ? ChevronUpIcon : ChevronDownIcon" 
            class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
          </lucide-icon>
        </button>
        @if (expandedSections().rating) {
        <div class="px-5 pb-5 space-y-3 animate-slideDown">
          @for (rating of [4, 3, 2, 1]; track rating) {
          <label class="flex items-center gap-3 cursor-pointer group select-none">
            <input 
              type="radio" 
              name="rating"
              [checked]="minRating() === rating"
              (change)="minRating.set(rating)"
              class="w-5 h-5 text-indigo-600 border-gray-300 focus:ring-indigo-600 focus:ring-2 cursor-pointer" />
            <div class="flex items-center gap-1.5">
              <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 transition-colors">{{ rating }}+</span>
              <span class="text-yellow-400 text-sm">⭐</span>
            </div>
          </label>
          }
        </div>
        }
      </div>
    </div>

    <!-- Footer with Apply Button -->
    <div class="sticky bottom-0 bg-white border-t border-gray-200 p-4 shadow-lg">
      <button
        class="w-full bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-[1.02] active:scale-95 shadow-md hover:shadow-lg">
        Apply Filters
      </button>
    </div>
  </div>
</div>
}

<!-- DESKTOP SIDEBAR -->
<aside class="hidden sm:flex flex-col w-80 bg-white shadow-xl rounded-2xl sticky top-6 h-fit max-h-[calc(100vh-3rem)] overflow-hidden border border-gray-100">
  
  <!-- Header with gradient -->
  <div class="bg-gradient-to-r from-indigo-600 to-indigo-700 text-white p-5 rounded-t-2xl">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <lucide-icon [img]="SliderIcon" class="w-6 h-6"></lucide-icon>
        <h3 class="text-xl font-bold">Filters</h3>
        @if (getActiveFilterCount() > 0) {
        <span class="bg-white text-indigo-600 text-xs font-bold px-2.5 py-1 rounded-full">
          {{ getActiveFilterCount() }}
        </span>
        }
      </div>
    </div>
    
    <!-- Search in header -->
    <div class="relative">
      <input
        type="text"
        [(ngModel)]="searchQuery"
        placeholder="Search products..."
        class="w-full pl-4 pr-10 py-2.5 rounded-xl placeholder:text-gray-400 text-gray-900 border-0 focus:outline-none focus:ring-2 focus:ring-white/30 text-sm shadow-sm" />
      <lucide-icon
        [img]="SearchIcon"
        class="w-5 h-5 absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></lucide-icon>
    </div>
  </div>

  <!-- Scrollable Filter Content -->
  <div class="overflow-y-auto flex-1 p-5 space-y-4">
    
    <!-- Clear All Button -->
    @if (hasActiveFilters()) {
    <button
      (click)="clearAllFilters()"
      class="w-full text-indigo-600 hover:text-indigo-700 font-medium text-sm py-2 px-4 border border-indigo-200 hover:border-indigo-300 rounded-lg transition-all duration-200 hover:bg-indigo-50">
      Clear All Filters
    </button>
    }

    <!-- Category Section -->
    <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
      <button
        (click)="toggleSection('category')"
        class="w-full flex items-center justify-between p-5 group">
        <div class="flex items-center gap-2.5">
          <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Category</span>
          @if (selectedCategories().length > 0) {
          <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full">
            {{ selectedCategories().length }}
          </span>
          }
        </div>
        <lucide-icon 
          [img]="expandedSections().category ? ChevronUpIcon : ChevronDownIcon" 
          class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
        </lucide-icon>
      </button>
      @if (expandedSections().category) {
      <div class="px-5 pb-5 space-y-3 animate-slideDown">
        @for (cat of categories; track cat.id) {
        <label class="flex items-start justify-between cursor-pointer group select-none">
          <div class="flex items-center gap-3">
            <div class="relative flex items-center">
              <input 
                type="checkbox" 
                [checked]="selectedCategories().includes(cat.id)"
                (change)="toggleCategory(cat.id)"
                class="peer appearance-none w-5 h-5 border-2 border-gray-300 rounded-md checked:bg-indigo-600 checked:border-indigo-600 focus:ring-0 transition-all duration-200 cursor-pointer" />
              <lucide-icon [img]="CheckIcon" class="absolute inset-0 m-auto w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity duration-200"></lucide-icon>
            </div>
            <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors">{{ cat.name }}</span>
          </div>
          <span class="text-xs text-gray-400 bg-gray-50 px-2 py-1 rounded-full">{{ cat.count }}</span>
        </label>
        }
      </div>
      }
    </div>

    <!-- Gender Section -->
    <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
      <button
        (click)="toggleSection('gender')"
        class="w-full flex items-center justify-between p-5 group">
        <div class="flex items-center gap-2.5">
          <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Gender</span>
          @if (selectedGenders().length > 0) {
          <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full">
            {{ selectedGenders().length }}
          </span>
          }
        </div>
        <lucide-icon 
          [img]="expandedSections().gender ? ChevronUpIcon : ChevronDownIcon" 
          class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
        </lucide-icon>
      </button>
      @if (expandedSections().gender) {
      <div class="px-5 pb-5 space-y-3 animate-slideDown">
        @for (gender of genders; track gender) {
        <label class="flex items-center gap-3 cursor-pointer group select-none">
          <div class="relative flex items-center">
            <input 
              type="checkbox" 
              [checked]="selectedGenders().includes(gender)"
              (change)="toggleGender(gender)"
              class="peer appearance-none w-5 h-5 border-2 border-gray-300 rounded-md checked:bg-indigo-600 checked:border-indigo-600 focus:ring-0 transition-all duration-200 cursor-pointer" />
            <lucide-icon [img]="CheckIcon" class="absolute inset-0 m-auto w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity duration-200"></lucide-icon>
          </div>
          <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors">{{ gender }}</span>
        </label>
        }
      </div>
      }
    </div>

    <!-- Brand Section -->
    <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
      <button
        (click)="toggleSection('brand')"
        class="w-full flex items-center justify-between p-5 group">
        <div class="flex items-center gap-2.5">
          <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Brand</span>
          @if (selectedBrands().length > 0) {
          <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full">
            {{ selectedBrands().length }}
          </span>
          }
        </div>
        <lucide-icon 
          [img]="expandedSections().brand ? ChevronUpIcon : ChevronDownIcon" 
          class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
        </lucide-icon>
      </button>
      @if (expandedSections().brand) {
      <div class="px-5 pb-5 space-y-3 animate-slideDown">
        @for (brand of brands; track brand) {
        <label class="flex items-center gap-3 cursor-pointer group select-none">
          <div class="relative flex items-center">
             <input 
              type="checkbox" 
              [checked]="selectedBrands().includes(brand)"
              (change)="toggleBrand(brand)"
              class="peer appearance-none w-5 h-5 border-2 border-gray-300 rounded-md checked:bg-indigo-600 checked:border-indigo-600 focus:ring-0 transition-all duration-200 cursor-pointer" />
               <lucide-icon [img]="CheckIcon" class="absolute inset-0 m-auto w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity duration-200"></lucide-icon>
          </div>
          <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors">{{ brand }}</span>
        </label>
        }
      </div>
      }
    </div>

    <!-- Price Range Section -->
    <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
      <button
        (click)="toggleSection('price')"
        class="w-full flex items-center justify-between p-5 group">
        <div class="flex items-center gap-2.5">
          <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Price Range</span>
          @if (minPrice() > 0 || maxPrice() < 500) {
          <span class="w-2 h-2 rounded-full bg-indigo-600"></span>
          }
        </div>
        <lucide-icon 
          [img]="expandedSections().price ? ChevronUpIcon : ChevronDownIcon" 
          class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
        </lucide-icon>
      </button>
      @if (expandedSections().price) {
      <div class="px-5 pb-5 space-y-4 animate-slideDown">
        <div class="flex items-center gap-3">
          <div class="flex-1 relative">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">$</span>
            <input 
              type="number" 
              [(ngModel)]="minPrice"
              min="0" 
              max="500"
              placeholder="0"
              class="w-full pl-6 pr-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm font-medium text-gray-700 transition-shadow" />
          </div>
          <span class="text-gray-300 font-medium">to</span>
          <div class="flex-1 relative">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">$</span>
            <input 
              type="number" 
              [(ngModel)]="maxPrice"
              min="0" 
              max="500"
              placeholder="500"
              class="w-full pl-6 pr-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm font-medium text-gray-700 transition-shadow" />
          </div>
        </div>
        <!-- Visual Range Bar (Mock) -->
        <div class="relative h-1.5 bg-gray-100 rounded-full overflow-hidden">
           <div class="absolute inset-y-0 bg-indigo-600/20 w-full"></div>
           <div class="absolute inset-y-0 left-[10%] right-[20%] bg-indigo-600 rounded-full"></div>
        </div>
      </div>
      }
    </div>

    <!-- Color Section -->
    <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
      <button
        (click)="toggleSection('color')"
        class="w-full flex items-center justify-between p-5 group">
        <div class="flex items-center gap-2.5">
          <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Color</span>
          @if (selectedColors().length > 0) {
          <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full">
            {{ selectedColors().length }}
          </span>
          }
        </div>
        <lucide-icon 
          [img]="expandedSections().color ? ChevronUpIcon : ChevronDownIcon" 
          class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
        </lucide-icon>
      </button>
      @if (expandedSections().color) {
      <div class="px-5 pb-5 animate-slideDown">
        <div class="flex flex-wrap gap-3">
          @for (color of colors; track color.id) {
          <button
            (click)="toggleColor(color.id)"
            [class.ring-2]="selectedColors().includes(color.id)"
            [class.ring-indigo-600]="selectedColors().includes(color.id)"
            [class.ring-offset-2]="selectedColors().includes(color.id)"
            class="relative w-9 h-9 rounded-full cursor-pointer transition-all duration-200 hover:scale-110 shadow-sm hover:shadow-md border border-gray-100"
            [style.backgroundColor]="color.hex"
            [title]="color.name">
            @if (selectedColors().includes(color.id)) {
            <svg class="absolute inset-0 m-auto w-4 h-4 text-white drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
            </svg>
            }
          </button>
          }
        </div>
      </div>
      }
    </div>

    <!-- Rating Section -->
    <div class="border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
      <button
        (click)="toggleSection('rating')"
        class="w-full flex items-center justify-between p-5 group">
        <div class="flex items-center gap-2.5">
          <span class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors">Rating</span>
          @if (minRating() > 0) {
          <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full">
            {{ minRating() }}+ ⭐
          </span>
          }
        </div>
        <lucide-icon 
          [img]="expandedSections().rating ? ChevronUpIcon : ChevronDownIcon" 
          class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors">
        </lucide-icon>
      </button>
      @if (expandedSections().rating) {
      <div class="px-5 pb-5 space-y-3 animate-slideDown">
        @for (rating of [4, 3, 2, 1]; track rating) {
        <label class="flex items-center gap-3 cursor-pointer group select-none">
          <input 
            type="radio" 
            name="rating"
            [checked]="minRating() === rating"
            (change)="minRating.set(rating)"
            class="w-5 h-5 text-indigo-600 border-gray-300 focus:ring-indigo-600 focus:ring-2 cursor-pointer" />
          <div class="flex items-center gap-1.5">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 transition-colors">{{ rating }}+</span>
            <span class="text-yellow-400 text-sm">⭐</span>
          </div>
        </label>
        }
      </div>
      }
    </div>
  </div>

  <!-- Footer with Apply Button -->
  <div class="sticky bottom-0 bg-white border-t border-gray-200 p-4 rounded-b-2xl">
    <button
      class="w-full bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-[1.02] active:scale-95 shadow-md hover:shadow-lg">
      Apply Filters
    </button>
  </div>
</aside>

<style>
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-slideDown {
    animation: slideDown 0.2s ease-out;
  }
</style>