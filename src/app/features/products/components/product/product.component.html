<div 
  class="group bg-white rounded-2xl shadow-md hover:shadow-2xl transition-all duration-300 overflow-hidden relative flex flex-col border border-gray-100 hover:border-rose-200 transform hover:-translate-y-1"
  (mouseenter)="isHovered.set(true)"
  (mouseleave)="isHovered.set(false)">

  <!-- Badges Container -->
  <div class="absolute top-3 left-3 z-20 flex flex-col gap-2">
    <!-- Discount Badge -->
    @if (hasDiscount()) {
    <span class="bg-gradient-to-r from-rose-600 to-rose-700 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg">
      -{{ getDiscountPercentage() }}%
    </span>
    }
    
    <!-- Stock Status Badge -->
    @if (getStockStatus() === 'low-stock') {
    <span class="bg-gradient-to-r from-orange-500 to-orange-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg">
      Low Stock
    </span>
    }
    @else if (getStockStatus() === 'out-of-stock') {
    <span class="bg-gradient-to-r from-gray-600 to-gray-700 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg">
      Out of Stock
    </span>
    }
  </div>

  <!-- Favorite Button -->
  <button 
    (click)="toggleFavorite($event)"
    [class.bg-rose-600]="isFavorite()"
    [class.bg-black/40]="!isFavorite()"
    class="absolute top-3 right-3 z-20 hover:bg-rose-700 p-2 rounded-full transition-all duration-200 shadow-lg backdrop-blur-sm hover:scale-110 active:scale-95">
    @if (isFavorite()) {
      <svg class="w-5 h-5 text-white fill-white" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    } @else {
      <lucide-icon [img]="HeartIcon" class="w-5 h-5" color="white"></lucide-icon>
    }
  </button>

  <!-- Product Image Container -->
  <div 
    routerLink="/products/{{product?.id}}" 
    class="relative w-full aspect-square bg-gradient-to-br from-gray-50 to-gray-100 cursor-pointer overflow-hidden group">
    
    <!-- Image with Zoom Effect -->
    <img 
      [src]="product?.images?.[0]?.url" 
      [alt]="product?.name" 
      (error)="onImgError($event)" 
      loading="lazy"
      class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" />
    
    <!-- Hover Overlay with Quick Actions -->
    <div 
      class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4">
      <button
        (click)="quickView($event)"
        class="bg-white text-gray-900 font-semibold px-6 py-2.5 rounded-full flex items-center gap-2 shadow-lg hover:bg-gray-100 transition-all duration-200 transform translate-y-4 group-hover:translate-y-0">
        <lucide-icon [img]="EyeIcon" class="w-4 h-4"></lucide-icon>
        <span class="text-sm">Quick View</span>
      </button>
    </div>
  </div>

  <!-- Product Info -->
  <div class="p-4 flex flex-col flex-1 justify-between space-y-3">
    
    <!-- Product Name -->
    <div>
      <h3 
        routerLink="/products/{{product?.id}}" 
        class="text-gray-900 font-bold text-base mb-1 line-clamp-2 cursor-pointer hover:text-rose-600 transition-colors leading-snug">
        {{ product?.name }}
      </h3>
      
      <!-- Rating -->
      <div class="flex items-center gap-1 mb-2">
        @for (star of [1,2,3,4,5]; track star) {
          @if (star <= getRating()) {
            <svg class="w-4 h-4 text-yellow-400 fill-yellow-400" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          } @else {
            <svg class="w-4 h-4 text-gray-300 fill-gray-300" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          }
        }
        <span class="text-xs text-gray-500 ml-1">({{ getRating() }}.0)</span>
      </div>
    </div>

    <!-- Price Section -->
    <div class="space-y-3">
      <div class="flex items-baseline gap-2">
        @if (hasDiscount()) {
        <span class="text-gray-400 line-through text-sm">${{ product?.price }}</span>
        <span class="text-rose-600 font-bold text-xl">${{ product?.price }}</span>
        } @else {
        <span class="text-rose-600 font-bold text-xl">${{ product?.price }}</span>
        }
      </div>

      <!-- Add to Cart Button -->
      <button
        (click)="addToCart($event)"
        [disabled]="getStockStatus() === 'out-of-stock'"
        [class.opacity-50]="getStockStatus() === 'out-of-stock'"
        [class.cursor-not-allowed]="getStockStatus() === 'out-of-stock'"
        class="w-full bg-gradient-to-r from-rose-600 to-rose-700 hover:from-rose-700 hover:to-rose-800 disabled:from-gray-400 disabled:to-gray-500 text-white font-semibold py-2.5 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 shadow-md hover:shadow-lg transform hover:scale-[1.02] active:scale-95">
        <lucide-icon [img]="ShoppingBagIcon" class="w-4 h-4"></lucide-icon>
        <span class="text-sm">
          {{ getStockStatus() === 'out-of-stock' ? 'Out of Stock' : 'Add to Cart' }}
        </span>
      </button>
    </div>
  </div>
</div>