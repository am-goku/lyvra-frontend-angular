<div 
  class="group relative flex flex-col h-full bg-white rounded-2xl transition-all duration-300 hover:shadow-[0_8px_30px_rgb(0,0,0,0.06)] p-4"
  (mouseenter)="isHovered.set(true)"
  (mouseleave)="isHovered.set(false)">

  <!-- IMAGE CONTAINER -->
  <div class="relative w-full aspect-[4/5] overflow-hidden rounded-2xl bg-gray-100">
    
    <!-- Product Image -->
    <img 
      [src]="product?.images?.[0]?.url" 
      [alt]="product?.name" 
      (error)="onImgError($event)" 
      loading="lazy"
      class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" />

    <!-- Overlay & Quick Actions (Desktop) -->
    <div class="absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>

    <!-- Floating Actions -->
    <div class="absolute top-3 right-3 flex flex-col gap-2 z-10 translate-x-12 group-hover:translate-x-0 transition-transform duration-300">
      
      <!-- Favorite Button -->
      <button 
        (click)="toggleFavorite($event)"
        class="w-10 h-10 rounded-full flex items-center justify-center bg-white text-gray-700 shadow-md hover:bg-indigo-600 hover:text-white transition-all duration-200"
        title="Add to Wishlist">
        @if (isFavorite()) {
          <svg class="w-5 h-5 fill-current text-current" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        } @else {
          <lucide-icon [img]="HeartIcon" class="w-5 h-5"></lucide-icon>
        }
      </button>

      <!-- Quick View Button -->
      <button 
        (click)="quickView($event)"
        class="w-10 h-10 rounded-full flex items-center justify-center bg-white text-gray-700 shadow-md hover:bg-indigo-600 hover:text-white transition-all duration-200 delay-75"
        title="Quick View">
        <lucide-icon [img]="EyeIcon" class="w-5 h-5"></lucide-icon>
      </button>
    </div>

    <!-- Badges -->
    <div class="absolute top-3 left-3 flex flex-col gap-2 pointer-events-none">
      @if (hasDiscount()) {
      <span class="bg-red-500 text-white text-[10px] font-bold px-2.5 py-1 rounded-full shadow-sm tracking-wide">
        -{{ getDiscountPercentage() }}%
      </span>
      }
      @if (getStockStatus() === 'low-stock') {
      <span class="bg-amber-500 text-white text-[10px] font-bold px-2.5 py-1 rounded-full shadow-sm tracking-wide">
        LOW STOCK
      </span>
      }
    </div>

    <!-- Add to Cart (Desktop Hover / Mobile Visible) -->
    <div class="absolute bottom-4 left-4 right-4 translate-y-full opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300">
      <button
        (click)="addToCart($event)"
        [disabled]="getStockStatus() === 'out-of-stock'"
        class="w-full bg-white text-gray-900 font-bold py-3 rounded-xl shadow-lg hover:bg-black hover:text-white transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
        @if (isAddingToCart()) {
          <div class="w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"></div>
        } @else {
          <lucide-icon [img]="ShoppingBagIcon" class="w-4 h-4"></lucide-icon>
          <span>{{ getStockStatus() === 'out-of-stock' ? 'Out of Stock' : 'Add to Cart' }}</span>
        }
      </button>
    </div>
  </div>

  <!-- PRODUCT INFO -->
  <div class="pt-4 flex flex-col gap-1">
    
    <!-- Brand / Category (Optional) -->
    <p class="text-xs font-medium text-gray-400 uppercase tracking-wider">Premium Collection</p>

    <!-- Name -->
    <h3 
      routerLink="/products/{{product?.id}}" 
      class="text-gray-900 font-bold text-sm md:text-base leading-snug cursor-pointer hover:text-indigo-600 transition-colors line-clamp-2 min-h-[2.5rem]">
      {{ product?.name }}
    </h3>

    <!-- Price & Rating -->
    <div class="flex items-center justify-between mt-1">
      <app-price-tag 
        [price]="product?.price!" 
        [originalPrice]="product?.originalPrice"
        size="lg"
        [showBadge]="false">
      </app-price-tag>

      <!-- Compact Rating -->
      <div class="flex items-center gap-1">
        <svg class="w-3.5 h-3.5 text-yellow-400 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
        <span class="text-xs font-medium text-gray-600">{{ getRating() }}.0</span>
      </div>
    </div>
  </div>

</div>
