<section class="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">
  <h2 class="text-2xl font-bold mb-6">Shipping Address</h2>

  @if (isLoading() && addresses().length === 0) {
    <p class="text-gray-500">Loading addresses...</p>
  }

  <!-- List existing addresses -->
  @if (addresses().length > 0) {
    <div class="flex flex-col gap-4 mb-6">
      @for (addr of addresses(); track addr.id) {
        <label class="flex items-start gap-3 p-4 border rounded-xl cursor-pointer hover:border-rose-600 transition"
               [class.border-rose-600]="selectedAddressId() === addr.id"
               [class.bg-rose-50]="selectedAddressId() === addr.id">
          <input type="radio" 
                 [name]="'address'" 
                 [value]="addr.id" 
                 [checked]="selectedAddressId() === addr.id"
                 (change)="selectAddress(addr.id!)"
                 class="mt-1 w-4 h-4 accent-rose-600">
          <div class="flex flex-col">
            <span class="font-semibold text-gray-800">{{ addr.name }}</span>
            <span class="text-gray-600">{{ addr.street }}, {{ addr.city }}</span>
            <span class="text-gray-600">{{ addr.state }}, {{ addr.zip }}</span>
            <span class="text-gray-500 text-sm mt-1">Phone: {{ addr.phone }}</span>
          </div>
        </label>
      }
    </div>
  }

  <!-- Add New Address Button -->
  @if (!showForm()) {
    <button (click)="toggleForm()" class="flex items-center gap-2 text-rose-600 font-semibold hover:text-rose-700 transition">
      <lucide-icon [img]="PlusIcon" class="w-5 h-5"></lucide-icon>
      Add New Address
    </button>
  }

  <!-- New Address Form -->
  @if (showForm()) {
    <form (ngSubmit)="saveAddress()" class="flex flex-col gap-4 mt-6 p-4 border border-gray-200 rounded-xl">
      <h3 class="text-lg font-semibold mb-2">New Address Details</h3>
      
      <!-- Name & Email -->
      <div class="flex flex-col sm:flex-row gap-4">
        <input type="text" placeholder="Full Name"
          class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:outline-none"
          [(ngModel)]="newAddress.name" name="name" required />
        <input type="email" placeholder="Email"
          class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:outline-none"
          [(ngModel)]="newAddress.email" name="email" required />
      </div>

      <!-- Phone -->
      <input type="tel" placeholder="Phone Number"
        class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:outline-none"
        [(ngModel)]="newAddress.phone" name="phone" required />

      <!-- Address -->
      <input type="text" placeholder="Street Address"
        class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:outline-none"
        [(ngModel)]="newAddress.street" name="street" required />

      <div class="flex flex-col sm:flex-row gap-4">
        <input type="text" placeholder="City"
          class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:outline-none"
          [(ngModel)]="newAddress.city" name="city" required />
        <input type="text" placeholder="State"
          class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:outline-none"
          [(ngModel)]="newAddress.state" name="state" required />
        <input type="text" placeholder="Zip Code"
          class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:outline-none"
          [(ngModel)]="newAddress.zip" name="zip" required />
      </div>

      <!-- Country -->
      <input type="text" placeholder="Country"
          class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:outline-none"
          [(ngModel)]="newAddress.country" name="country" required />

      <label class="flex items-center gap-2 mt-2 text-gray-700">
        <input type="checkbox" [(ngModel)]="newAddress.isDefault" name="isDefault" class="w-4 h-4 accent-rose-600" />
        Set as default address
      </label>

      <div class="flex gap-3 mt-4 justify-end">
        <button type="button" (click)="toggleForm()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button>
        <button type="submit" [disabled]="isLoading()" class="px-6 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700 disabled:opacity-50">
          {{ isLoading() ? 'Saving...' : 'Save Address' }}
        </button>
      </div>
    </form>
  }
</section>